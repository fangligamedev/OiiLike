# AntiGravity å¤šæ™ºèƒ½ä½“åä½œå¹³å° - è½¯ä»¶è®¾è®¡æ–‡æ¡£ (SDD)

> **ç‰ˆæœ¬**: 1.0  
> **æ—¥æœŸ**: 2025-12-29  
> **é¡¹ç›®ä»£å·**: OiiLike (AntiGravity Agent Workspace)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 ç›®æ ‡
å¤åˆ» [OiiOii.ai Space](https://www.oiioii.ai/space/3461b584-51e9-432f-b51c-c2a5c674714c) çš„å‰ç«¯äº¤äº’ä½“éªŒï¼Œæ›¿æ¢ä¸º **AntiGravity** å››æ™ºèƒ½ä½“ç³»ç»Ÿï¼ˆProducerã€VoidShaperã€CodeWeaverã€Inquisitorï¼‰ï¼Œå¹¶æ„å»ºæ•°æ®é©±åŠ¨çš„åç«¯æ¶æ„ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½
| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| å¤šæ™ºèƒ½ä½“å¯¹è¯ | ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€ï¼Œç”± Producer åˆ†è§£ä»»åŠ¡å¹¶åˆ†å‘ç»™å…¶ä»–æ™ºèƒ½ä½“ |
| å¯è§†åŒ–ç”»å¸ƒ | å±•ç¤ºæ™ºèƒ½ä½“äº§å‡ºçš„èµ„äº§ï¼ˆä»£ç ã€å›¾åƒã€æµ‹è¯•æŠ¥å‘Šï¼‰åŠåä½œæµç¨‹ |
| é»‘æ¿ç³»ç»Ÿ | æ™ºèƒ½ä½“é—´å…±äº«çŠ¶æ€çš„å®æ—¶æ•°æ®æ€»çº¿ |
| ä»»åŠ¡è¿½è¸ª | å±•ç¤ºæ¯ä¸ªå­ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ä¸éªŒæ”¶ç»“æœ |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph Frontend["å‰ç«¯ (React + TLDraw)"]
        UI[ç”¨æˆ·ç•Œé¢]
        ChatPanel[å¯¹è¯é¢æ¿]
        Canvas[å¯è§†åŒ–ç”»å¸ƒ]
        Navbar[å¯¼èˆªæ ]
    end
    
    subgraph Backend["åç«¯ (Node.js/Python)"]
        API[REST API Gateway]
        WS[WebSocket Server]
        Orchestrator[ä»»åŠ¡ç¼–æ’å™¨]
        Blackboard[é»‘æ¿ç³»ç»Ÿ]
    end
    
    subgraph Agents["æ™ºèƒ½ä½“å±‚"]
        Producer[Producer<br/>åˆ¶ä½œäºº]
        VoidShaper[VoidShaper<br/>è™šç©ºå¡‘å½¢è€…]
        CodeWeaver[CodeWeaver<br/>ä»£ç ç¼–ç»‡è€…]
        Inquisitor[Inquisitor<br/>å®¡åˆ¤å®˜]
    end
    
    subgraph External["å¤–éƒ¨æœåŠ¡"]
        LLM[LLM API<br/>GPT-4/Claude]
        ImageGen[å›¾åƒç”Ÿæˆ<br/>SD/DALL-E]
        AudioGen[éŸ³é¢‘ç”Ÿæˆ<br/>Suno]
    end
    
    UI --> API
    UI <--> WS
    API --> Orchestrator
    Orchestrator --> Blackboard
    Blackboard --> Producer
    Producer --> VoidShaper
    Producer --> CodeWeaver
    Producer --> Inquisitor
    VoidShaper --> ImageGen
    CodeWeaver --> LLM
    Inquisitor --> LLM
    WS --> ChatPanel
    WS --> Canvas
```

### 2.2 æŠ€æœ¯é€‰å‹

| å±‚çº§ | æŠ€æœ¯æ ˆ | ç†ç”± |
|------|--------|------|
| **å‰ç«¯æ¡†æ¶** | Next.js 14 (App Router) | SSRæ”¯æŒã€ä¼˜ç§€çš„å¼€å‘ä½“éªŒ |
| **UIç»„ä»¶** | Radix UI + è‡ªå®šä¹‰æ ·å¼ | æ— éšœç¢ã€å¯å®šåˆ¶ |
| **ç”»å¸ƒå¼•æ“** | TLDraw | å¼€æºã€æ”¯æŒåä½œã€æ˜“æ‰©å±• |
| **çŠ¶æ€ç®¡ç†** | Zustand | è½»é‡ã€æ”¯æŒä¸­é—´ä»¶ |
| **åç«¯æ¡†æ¶** | FastAPI (Python) | å¼‚æ­¥æ”¯æŒå¥½ã€é€‚åˆAIå·¥ä½œæµ |
| **å®æ—¶é€šä¿¡** | WebSocket (Socket.IO) | åŒå‘å®æ—¶æ¨é€ |
| **æ•°æ®åº“** | PostgreSQL + Redis | æŒä¹…åŒ– + ç¼“å­˜/æ¶ˆæ¯é˜Ÿåˆ— |
| **æ¶ˆæ¯é˜Ÿåˆ—** | Redis Pub/Sub | æ™ºèƒ½ä½“é—´é€šä¿¡ |

---

## 3. å‰ç«¯è®¾è®¡

### 3.1 é¡µé¢å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Logo   â”‚          é¡¹ç›®æ ‡é¢˜          â”‚  ç§¯åˆ†  â”‚  åˆ†äº«  â”‚  ç”¨æˆ·  â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚                                                            â”‚
â”‚ å¯¼ â”‚     å¯¹è¯/å·¥ä½œæµé¢æ¿ (~35%)      â”‚    å¯è§†åŒ–ç”»å¸ƒ (~60%)     â”‚
â”‚ èˆª â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ æ  â”‚  â”‚ [Producer] ä»»åŠ¡åˆ†è§£ä¸­...â”‚   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚    â”‚  â”‚ âœ“ å·²è·å–çŸ¥è¯†åº“          â”‚   â”‚  â”‚   â”‚ èµ„äº§ â”‚â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚ 60 â”‚  â”‚ âœ“ å·²åˆ†é…ç»™ VoidShaper   â”‚   â”‚  â”‚   â”‚ èŠ‚ç‚¹ â”‚     â”‚   â”‚  â”‚
â”‚ px â”‚  â”‚                         â”‚   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”˜     â–¼   â”‚  â”‚
â”‚    â”‚  â”‚ [VoidShaper] ç”Ÿæˆçº¹ç†..â”‚   â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚    â”‚  â”‚ ğŸ¨ Stable Diffusion     â”‚   â”‚  â”‚          â”‚ ä»£ç  â”‚   â”‚  â”‚
â”‚    â”‚  â”‚                         â”‚   â”‚  â”‚          â”‚ èŠ‚ç‚¹ â”‚   â”‚  â”‚
â”‚    â”‚  â”‚ [CodeWeaver] ç¼–å†™é€»è¾‘..â”‚   â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚  â”‚ ğŸ…°ï¸ è¾“å…¥æ¶ˆæ¯...          â”‚   â”‚  â”‚  â•  â–  ğŸ–ï¸  ğŸ”²  â”‚  â”‚
â”‚    â”‚  â”‚ [+] [é£æ ¼] [è§’è‰²] [å‘é€]â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                          â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç»„ä»¶å±‚çº§

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx              # å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                # é¦–é¡µ
â”‚   â””â”€â”€ space/
â”‚       â””â”€â”€ [id]/
â”‚           â””â”€â”€ page.tsx        # å·¥ä½œç©ºé—´é¡µé¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ Navbar.tsx          # å·¦ä¾§å¯¼èˆªæ 
â”‚   â”‚   â”œâ”€â”€ Header.tsx          # é¡¶éƒ¨æ ‡é¢˜æ 
â”‚   â”‚   â””â”€â”€ ResizablePanel.tsx  # å¯è°ƒæ•´å®½åº¦çš„é¢æ¿
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ ChatPanel.tsx       # å¯¹è¯é¢æ¿å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx   # æ¶ˆæ¯æ°”æ³¡
â”‚   â”‚   â”œâ”€â”€ AgentHeader.tsx     # æ™ºèƒ½ä½“å¤´éƒ¨(å¤´åƒ+åç§°)
â”‚   â”‚   â”œâ”€â”€ StatusCard.tsx      # ä»»åŠ¡çŠ¶æ€å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ ThinkingProcess.tsx # æ€è€ƒè¿‡ç¨‹æŠ˜å åŒº
â”‚   â”‚   â””â”€â”€ MessageInput.tsx    # æ¶ˆæ¯è¾“å…¥æ¡†
â”‚   â”œâ”€â”€ canvas/
â”‚   â”‚   â”œâ”€â”€ WorkspaceCanvas.tsx # TLDrawç”»å¸ƒå°è£…
â”‚   â”‚   â”œâ”€â”€ AssetNode.tsx       # èµ„äº§èŠ‚ç‚¹(å›¾åƒ/è§†é¢‘)
â”‚   â”‚   â”œâ”€â”€ CodeNode.tsx        # ä»£ç èŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ TestNode.tsx        # æµ‹è¯•æŠ¥å‘ŠèŠ‚ç‚¹
â”‚   â”‚   â””â”€â”€ ConnectionLine.tsx  # èŠ‚ç‚¹è¿æ¥çº¿
â”‚   â””â”€â”€ agents/
â”‚       â”œâ”€â”€ AgentAvatar.tsx     # æ™ºèƒ½ä½“å¤´åƒç»„ä»¶
â”‚       â””â”€â”€ AgentConfig.ts      # æ™ºèƒ½ä½“é…ç½®(é¢œè‰²/å›¾æ ‡)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useWebSocket.ts         # WebSocketè¿æ¥
â”‚   â”œâ”€â”€ useBlackboard.ts        # é»‘æ¿çŠ¶æ€è®¢é˜…
â”‚   â””â”€â”€ useAgentStream.ts       # æ™ºèƒ½ä½“æµå¼è¾“å‡º
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ chatStore.ts            # å¯¹è¯çŠ¶æ€
â”‚   â”œâ”€â”€ canvasStore.ts          # ç”»å¸ƒçŠ¶æ€
â”‚   â””â”€â”€ agentStore.ts           # æ™ºèƒ½ä½“çŠ¶æ€
â””â”€â”€ styles/
    â”œâ”€â”€ globals.css             # å…¨å±€æ ·å¼
    â”œâ”€â”€ theme.css               # ä¸»é¢˜å˜é‡
    â””â”€â”€ components/             # ç»„ä»¶æ ·å¼
```

### 3.3 è®¾è®¡è§„èŒƒ

#### 3.3.1 è‰²å½©ç³»ç»Ÿ

```css
:root {
  /* èƒŒæ™¯è‰² */
  --bg-primary: #0D0D0D;
  --bg-secondary: #121212;
  --bg-panel: #1A1A1A;
  --bg-card: rgba(26, 26, 26, 0.8);
  
  /* å¼ºè°ƒè‰² - æ™ºèƒ½ä½“ä¸“å± */
  --color-producer: #FF3399;      /* éœ“è™¹ç²‰ - Producer */
  --color-voidshaper: #8B5CF6;    /* ç´«ç½—å…° - VoidShaper */
  --color-codeweaver: #10B981;    /* ç¿ ç»¿ - CodeWeaver */
  --color-inquisitor: #F59E0B;    /* ç¥ç€ - Inquisitor */
  
  /* çŠ¶æ€è‰² */
  --status-success: #4ADE80;
  --status-pending: #FACC15;
  --status-error: #EF4444;
  
  /* æ–‡å­—è‰² */
  --text-primary: #FFFFFF;
  --text-secondary: rgba(255, 255, 255, 0.7);
  --text-muted: rgba(255, 255, 255, 0.5);
  
  /* è¾¹æ¡†ä¸é˜´å½± */
  --border-subtle: rgba(255, 255, 255, 0.1);
  --glow-pink: 0 0 20px rgba(255, 51, 153, 0.4);
}
```

#### 3.3.2 æ™ºèƒ½ä½“è§†è§‰æ ‡è¯†

| æ™ºèƒ½ä½“ | å›¾æ ‡ | ä¸»è‰² | æ€§æ ¼å…³é”®è¯ |
|--------|------|------|-----------|
| **Producer** | ğŸ¬ å¯¼æ¼”æ¿ | `#FF3399` | æ²‰ç¨³ã€ç»Ÿç­¹ã€æŠŠå…³ |
| **VoidShaper** | ğŸ¨ è°ƒè‰²æ¿ | `#8B5CF6` | æ„Ÿæ€§ã€åˆ›é€ åŠ›ã€è‰ºæœ¯ |
| **CodeWeaver** | âš™ï¸ é½¿è½® | `#10B981` | ä¸¥è°¨ã€é€»è¾‘ã€è§„èŒƒ |
| **Inquisitor** | ğŸ” æ”¾å¤§é•œ | `#F59E0B` | å®¡æ…ã€æ´å¯Ÿã€çº é”™ |

---

## 4. åç«¯è®¾è®¡

### 4.1 API è®¾è®¡

#### 4.1.1 RESTful ç«¯ç‚¹

```yaml
# å·¥ä½œç©ºé—´ç®¡ç†
POST   /api/spaces              # åˆ›å»ºå·¥ä½œç©ºé—´
GET    /api/spaces/:id          # è·å–å·¥ä½œç©ºé—´è¯¦æƒ…
DELETE /api/spaces/:id          # åˆ é™¤å·¥ä½œç©ºé—´

# æ¶ˆæ¯ä¸ä»»åŠ¡
POST   /api/spaces/:id/messages # å‘é€ç”¨æˆ·æ¶ˆæ¯
GET    /api/spaces/:id/messages # è·å–å†å²æ¶ˆæ¯
GET    /api/spaces/:id/tasks    # è·å–ä»»åŠ¡åˆ—è¡¨

# èµ„äº§ç®¡ç†
GET    /api/spaces/:id/assets   # è·å–èµ„äº§åˆ—è¡¨
GET    /api/assets/:id/download # ä¸‹è½½èµ„äº§
```

#### 4.1.2 WebSocket äº‹ä»¶

```typescript
// å®¢æˆ·ç«¯ -> æœåŠ¡ç«¯
interface ClientEvents {
  'user:message': { content: string; spaceId: string };
  'canvas:update': { nodeId: string; position: Position };
}

// æœåŠ¡ç«¯ -> å®¢æˆ·ç«¯
interface ServerEvents {
  'agent:thinking': { agent: AgentType; content: string };
  'agent:message': { agent: AgentType; content: string; status: 'streaming' | 'complete' };
  'task:update': { taskId: string; status: TaskStatus; progress: number };
  'asset:created': { assetId: string; type: 'image' | 'code' | 'audio'; url: string };
  'blackboard:update': { key: string; value: any };
}
```

### 4.2 æ•°æ®æ¨¡å‹

```typescript
// å·¥ä½œç©ºé—´
interface Space {
  id: string;
  title: string;
  userId: string;
  createdAt: Date;
  updatedAt: Date;
}

// æ¶ˆæ¯
interface Message {
  id: string;
  spaceId: string;
  role: 'user' | 'producer' | 'voidshaper' | 'codeweaver' | 'inquisitor';
  content: string;
  metadata?: {
    thinkingProcess?: string;
    statusCards?: StatusCard[];
  };
  createdAt: Date;
}

// ä»»åŠ¡
interface Task {
  id: string;
  spaceId: string;
  parentTaskId?: string;
  assignedAgent: AgentType;
  type: 'generate_image' | 'write_code' | 'run_test' | 'review';
  status: 'pending' | 'running' | 'completed' | 'failed';
  input: Record<string, any>;
  output?: Record<string, any>;
  createdAt: Date;
  completedAt?: Date;
}

// èµ„äº§
interface Asset {
  id: string;
  spaceId: string;
  taskId: string;
  type: 'image' | 'code' | 'audio' | 'test_report';
  name: string;
  url: string;
  metadata: Record<string, any>;
  createdAt: Date;
}

// é»‘æ¿æ•°æ®
interface BlackboardEntry {
  key: string;
  value: any;
  updatedBy: AgentType;
  updatedAt: Date;
}
```

### 4.3 æ™ºèƒ½ä½“åä½œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant P as Producer
    participant V as VoidShaper
    participant C as CodeWeaver
    participant I as Inquisitor
    participant B as Blackboard
    
    U->>P: "æˆ‘æƒ³åšä¸€ä¸ªèƒ½è¢«ç©å®¶æ¨åŠ¨çš„ç®±å­"
    P->>B: è§£æéœ€æ±‚ï¼Œå‘å¸ƒä»»åŠ¡
    B-->>V: Task: ç”Ÿæˆæœ¨ç®±çº¹ç†
    B-->>C: Task: ç¼–å†™æ¨åŠ¨é€»è¾‘
    
    par å¹¶è¡Œæ‰§è¡Œ
        V->>V: è°ƒç”¨ Stable Diffusion
        V->>B: ä¸Šä¼ çº¹ç†è·¯å¾„
    and
        C->>B: ç­‰å¾…çº¹ç†è·¯å¾„
        B-->>C: çº¹ç†è·¯å¾„å°±ç»ª
        C->>C: ç”Ÿæˆ GDScript
        C->>B: ä¸Šä¼ ä»£ç 
    end
    
    B-->>I: Task: ç¼–å†™å¹¶è¿è¡Œæµ‹è¯•
    I->>I: ç”Ÿæˆ test_box_push.gd
    I->>I: æ‰§è¡Œ GUT æµ‹è¯•
    I->>B: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
    
    B-->>P: æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ
    P->>P: å®¡ç¾å®¡æ ¸ + åŠŸèƒ½éªŒæ”¶
    P->>U: éªŒæ”¶å®Œæˆï¼Œå±•ç¤ºæˆæœ
```

---

## 5. é»‘æ¿ç³»ç»Ÿè®¾è®¡

### 5.1 æ¦‚å¿µè¯´æ˜
é»‘æ¿ï¼ˆBlackboardï¼‰æ˜¯æ™ºèƒ½ä½“é—´å…±äº«çŠ¶æ€çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œé‡‡ç”¨ **å‘å¸ƒ-è®¢é˜…** æ¨¡å¼å®ç°è§£è€¦é€šä¿¡ã€‚

### 5.2 æ•°æ®ç»“æ„

```typescript
interface Blackboard {
  // ä»»åŠ¡é˜Ÿåˆ—
  tasks: {
    pending: Task[];
    running: Map<AgentType, Task>;
    completed: Task[];
  };
  
  // å…±äº«èµ„æº
  resources: {
    textures: Map<string, string>;  // name -> path
    scripts: Map<string, string>;   // name -> path
    testResults: Map<string, TestResult>;
  };
  
  // æ™ºèƒ½ä½“çŠ¶æ€
  agentStatus: Map<AgentType, 'idle' | 'busy' | 'waiting'>;
  
  // ç”¨æˆ·ä¸Šä¸‹æ–‡
  context: {
    originalRequest: string;
    projectType: 'godot' | 'unity' | 'web';
    preferences: Record<string, any>;
  };
}
```

### 5.3 æ¶ˆæ¯æ ¼å¼

```typescript
interface BlackboardMessage {
  type: 'task_publish' | 'task_claim' | 'task_complete' | 'resource_update';
  sender: AgentType;
  payload: any;
  timestamp: Date;
}
```

---

## 6. æµ‹è¯•ç­–ç•¥

### 6.1 æµ‹è¯•å±‚çº§

| å±‚çº§ | æµ‹è¯•ç±»å‹ | å·¥å…· | è¦†ç›–ç›®æ ‡ |
|------|----------|------|----------|
| å•å…ƒæµ‹è¯• | ç»„ä»¶æµ‹è¯• | Jest + React Testing Library | å‰ç«¯ç»„ä»¶ |
| å•å…ƒæµ‹è¯• | APIæµ‹è¯• | Pytest | åç«¯ç«¯ç‚¹ |
| é›†æˆæµ‹è¯• | æ™ºèƒ½ä½“åä½œ | Pytest + Mock | å¤šæ™ºèƒ½ä½“æµç¨‹ |
| E2Eæµ‹è¯• | å®Œæ•´æµç¨‹ | Playwright | ç”¨æˆ·äº¤äº’ |

### 6.2 æµ‹è¯•ç”¨ä¾‹è®¾è®¡

#### 6.2.1 E2E æµ‹è¯•: å®Œæ•´å·¥ä½œæµ

```typescript
// tests/e2e/workflow.spec.ts
test('å®Œæ•´çš„æ™ºèƒ½ä½“åä½œæµç¨‹', async ({ page }) => {
  // 1. å¯¼èˆªåˆ°å·¥ä½œç©ºé—´
  await page.goto('/space/test-space-id');
  
  // 2. å‘é€ç”¨æˆ·è¯·æ±‚
  await page.fill('[data-testid="message-input"]', 'æˆ‘æƒ³åšä¸€ä¸ªèƒ½è¢«ç©å®¶æ¨åŠ¨çš„ç®±å­');
  await page.click('[data-testid="send-button"]');
  
  // 3. éªŒè¯ Producer å“åº”
  await expect(page.locator('[data-agent="producer"]')).toBeVisible();
  await expect(page.locator('text=ä»»åŠ¡åˆ†è§£')).toBeVisible();
  
  // 4. éªŒè¯ VoidShaper å¼€å§‹å·¥ä½œ
  await expect(page.locator('[data-agent="voidshaper"]')).toBeVisible({ timeout: 10000 });
  await expect(page.locator('text=ç”Ÿæˆçº¹ç†')).toBeVisible();
  
  // 5. éªŒè¯ CodeWeaver å¼€å§‹å·¥ä½œ
  await expect(page.locator('[data-agent="codeweaver"]')).toBeVisible({ timeout: 10000 });
  await expect(page.locator('text=ç¼–å†™é€»è¾‘')).toBeVisible();
  
  // 6. éªŒè¯ Inquisitor æµ‹è¯•
  await expect(page.locator('[data-agent="inquisitor"]')).toBeVisible({ timeout: 15000 });
  await expect(page.locator('text=æµ‹è¯•é€šè¿‡')).toBeVisible();
  
  // 7. éªŒè¯ç”»å¸ƒä¸Šå‡ºç°èµ„äº§èŠ‚ç‚¹
  await expect(page.locator('[data-testid="asset-node"]')).toHaveCount(2);
  
  // 8. éªŒè¯ Producer éªŒæ”¶
  await expect(page.locator('text=éªŒæ”¶å®Œæˆ')).toBeVisible({ timeout: 20000 });
});
```

#### 6.2.2 å•å…ƒæµ‹è¯•: é»‘æ¿ç³»ç»Ÿ

```python
# tests/unit/test_blackboard.py
import pytest
from app.blackboard import Blackboard, Task, AgentType

class TestBlackboard:
    def test_publish_task(self):
        """æµ‹è¯•ä»»åŠ¡å‘å¸ƒ"""
        bb = Blackboard()
        task = Task(
            id="task-001",
            type="generate_image",
            assigned_agent=AgentType.VOIDSHAPER,
            input={"prompt": "wooden crate texture"}
        )
        bb.publish_task(task)
        assert task in bb.tasks["pending"]
    
    def test_claim_task(self):
        """æµ‹è¯•ä»»åŠ¡è®¤é¢†"""
        bb = Blackboard()
        task = Task(id="task-001", type="generate_image", assigned_agent=AgentType.VOIDSHAPER)
        bb.publish_task(task)
        
        claimed = bb.claim_task(AgentType.VOIDSHAPER)
        assert claimed.id == "task-001"
        assert bb.agent_status[AgentType.VOIDSHAPER] == "busy"
    
    def test_resource_sharing(self):
        """æµ‹è¯•èµ„æºå…±äº«"""
        bb = Blackboard()
        bb.update_resource("textures", "crate", "res://assets/crate.png")
        
        path = bb.get_resource("textures", "crate")
        assert path == "res://assets/crate.png"
```

---

## 7. å®ç°è®¡åˆ’

### 7.1 é˜¶æ®µåˆ’åˆ†

```mermaid
gantt
    title AntiGravity å¼€å‘é‡Œç¨‹ç¢‘
    dateFormat  YYYY-MM-DD
    
    section Phase 1: å‰ç«¯éª¨æ¶
    é¡¹ç›®åˆå§‹åŒ– & é…ç½®       :p1-1, 2025-01-01, 2d
    å¸ƒå±€ç»„ä»¶å¼€å‘            :p1-2, after p1-1, 3d
    å¯¹è¯é¢æ¿å®ç°            :p1-3, after p1-2, 4d
    TLDraw ç”»å¸ƒé›†æˆ         :p1-4, after p1-2, 4d
    
    section Phase 2: åç«¯æ ¸å¿ƒ
    API æ¡†æ¶æ­å»º            :p2-1, after p1-3, 2d
    WebSocket å®ç°          :p2-2, after p2-1, 3d
    é»‘æ¿ç³»ç»Ÿå¼€å‘            :p2-3, after p2-2, 4d
    æ•°æ®åº“æ¨¡å‹              :p2-4, after p2-1, 2d
    
    section Phase 3: æ™ºèƒ½ä½“
    Producer é€»è¾‘           :p3-1, after p2-3, 3d
    VoidShaper é›†æˆ         :p3-2, after p3-1, 3d
    CodeWeaver é›†æˆ         :p3-3, after p3-1, 3d
    Inquisitor é›†æˆ         :p3-4, after p3-2, 3d
    
    section Phase 4: æµ‹è¯• & ä¼˜åŒ–
    å•å…ƒæµ‹è¯•                :p4-1, after p3-4, 3d
    E2E æµ‹è¯•                :p4-2, after p4-1, 3d
    æ€§èƒ½ä¼˜åŒ–                :p4-3, after p4-2, 2d
```

### 7.2 æ–‡ä»¶ç»“æ„

```
oiiLike/
â”œâ”€â”€ frontend/                    # Next.js å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â””â”€â”€ e2e/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ next.config.js
â”‚
â”œâ”€â”€ backend/                     # FastAPI åç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py
â”‚   â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”‚   â”œâ”€â”€ producer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ voidshaper.py
â”‚   â”‚   â”‚   â”œâ”€â”€ codeweaver.py
â”‚   â”‚   â”‚   â””â”€â”€ inquisitor.py
â”‚   â”‚   â”œâ”€â”€ blackboard/
â”‚   â”‚   â”‚   â””â”€â”€ blackboard.py
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â””â”€â”€ integration/
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ shared/                      # å…±äº«ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ types/
â”‚
â”œâ”€â”€ docker-compose.yml           # æœ¬åœ°å¼€å‘ç¯å¢ƒ
â””â”€â”€ README.md
```

---

## 8. ç”¨æˆ·å®¡æ ¸äº‹é¡¹

> [!IMPORTANT]
> è¯·ç¡®è®¤ä»¥ä¸‹å…³é”®è®¾è®¡å†³ç­–ï¼š

1. **æŠ€æœ¯æ ˆé€‰æ‹©**: Next.js + FastAPI çš„ç»„åˆæ˜¯å¦ç¬¦åˆæ‚¨çš„æŠ€æœ¯åå¥½ï¼Ÿ
2. **æ™ºèƒ½ä½“è‰²å½©æ–¹æ¡ˆ**: å››ä¸ªæ™ºèƒ½ä½“çš„é¢œè‰²åˆ†é…ï¼ˆç²‰/ç´«/ç»¿/ç¥ç€ï¼‰æ˜¯å¦æ»¡æ„ï¼Ÿ
3. **é»‘æ¿ç³»ç»Ÿ**: æ˜¯å¦éœ€è¦æŒä¹…åŒ–é»‘æ¿çŠ¶æ€åˆ°æ•°æ®åº“ï¼Œè¿˜æ˜¯ä»…å†…å­˜ä¸­ç»´æŠ¤ï¼Ÿ
4. **å¤–éƒ¨ API é›†æˆ**: VoidShaper è°ƒç”¨å›¾åƒç”Ÿæˆ API çš„ä¼˜å…ˆçº§ (Stable Diffusion vs DALL-E)?
5. **æµ‹è¯•èŒƒå›´**: E2E æµ‹è¯•æ˜¯å¦éœ€è¦è¦†ç›–çœŸå® LLM è°ƒç”¨ï¼Œè¿˜æ˜¯å…¨éƒ¨ä½¿ç”¨ Mockï¼Ÿ

---

## 9. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

ç”¨æˆ·ç¡®è®¤æœ¬è®¾è®¡æ–‡æ¡£åï¼Œå°†æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

1. âœ… åˆå§‹åŒ–é¡¹ç›®ç»“æ„ (`frontend/` + `backend/`)
2. âœ… å¼€å‘å‰ç«¯å¸ƒå±€éª¨æ¶
3. âœ… å®ç°å¯¹è¯é¢æ¿ UI
4. âœ… é›†æˆ TLDraw ç”»å¸ƒ
5. âœ… æ„å»ºåç«¯ API ä¸ WebSocket
6. âœ… å®ç°é»‘æ¿ç³»ç»Ÿ
7. âœ… å¼€å‘å››ä¸ªæ™ºèƒ½ä½“æ¨¡å—
8. âœ… ç¼–å†™æµ‹è¯•ç”¨ä¾‹å¹¶éªŒè¯
